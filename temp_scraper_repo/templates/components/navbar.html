<!-- Top Navigation Bar with Authentication -->
<nav class="navbar navbar-expand-lg navbar-dark position-fixed w-100" 
     role="navigation" 
     aria-label="Main navigation"
     style="top: 0; left: 0; z-index: 2000;">
    <div class="container-fluid px-4">
        <!-- Brand -->
        <a href="{{ url_for('index') }}" 
           class="navbar-brand d-flex align-items-center text-decoration-none"
           aria-label="Enhanced Media Scraper home">
            <i class="fas fa-download me-2" aria-hidden="true"></i>
            <span class="site-title">Enhanced Media Scraper</span>
        </a>
        
        <!-- Theme Toggle -->
        <button id="theme-toggle-btn" 
                class="btn btn-outline-light btn-sm ms-3" 
                type="button"
                aria-label="Toggle dark/light theme"
                title="Toggle theme">
            <i class="fas fa-moon" id="theme-icon" aria-hidden="true"></i>
        </button>
        
        <!-- Spacer -->
        <div class="mx-auto"></div>
        
        <!-- User Section -->
        <div class="d-flex align-items-center gap-3">
            {% if current_user.is_authenticated %}
                <!-- Credits Display -->
                <div class="credits-display" 
                     id="credits-display"
                     role="status"
                     aria-label="Available credits">
                    <i class="fas fa-coins" aria-hidden="true"></i>
                    <span>Credits: <span class="credits-count" id="user-credits-count">{{ current_user.credits if current_user.credits else 0 }}</span></span>
                </div>
                
                <!-- Subscription Badge -->
                <div class="subscription-badge me-2" 
                     id="user-plan-badge"
                     role="status"
                     aria-label="Current subscription plan">
                    {{ current_user.subscription_plan if current_user.subscription_plan else 'Free' }}
                </div>
                
                <!-- User Menu -->
                <div class="dropdown">
                    <button class="btn p-0 border-0 position-relative" 
                            type="button" 
                            id="user-dropdown" 
                            data-bs-toggle="dropdown" 
                            aria-expanded="false" 
                            aria-haspopup="true"
                            aria-label="User menu">
                        {% if current_user.picture %}
                            <img src="{{ current_user.picture }}" 
                                 alt="{{ current_user.name or current_user.email }}" 
                                 class="user-avatar-image rounded-circle"
                                 style="width: 40px; height: 40px; object-fit: cover;"
                                 referrerpolicy="no-referrer">
                        {% else %}
                            <div class="user-avatar-badge" id="user-avatar-badge" data-user-email="{{ current_user.email }}" data-user-name="{{ current_user.name or '' }}">
                                {% set first_initial = current_user.name.split()[0][0].upper() if current_user.name else current_user.email[0].upper() %}
                                {% set last_initial = current_user.name.split()[1][0].upper() if current_user.name and current_user.name.split()|length > 1 else '' %}
                                {{ first_initial }}{{ last_initial }}
                            </div>
                        {% endif %}
                        {% if current_user.google_id %}
                        <span class="google-indicator" title="Signed in with Google" style="position: absolute !important; bottom: -2px !important; right: -2px !important; width: 18px !important; height: 18px !important; background: white !important; border-radius: 50% !important; border: 2px solid #4285f4 !important; display: flex !important; align-items: center !important; justify-content: center !important; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important; z-index: 10 !important;">
                            <img src="{{ url_for('static', filename='images/google-logo.svg') }}"
                                 alt="Google"
                                 width="12"
                                 height="12"
                                 style="width: 12px !important; height: 12px !important; display: block !important;">
                        </span>
                        {% endif %}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" 
                        aria-labelledby="user-dropdown"
                        role="menu">
                        <li role="presentation">
                            <h6 class="dropdown-header d-flex align-items-center" role="menuitem">
                                {% if current_user.picture %}
                                    <img src="{{ current_user.picture }}" 
                                         alt="{{ current_user.name or current_user.email }}" 
                                         class="rounded-circle me-2"
                                         style="width: 20px; height: 20px; object-fit: cover;"
                                         referrerpolicy="no-referrer">
                                {% else %}
                                    <i class="fas fa-user-circle me-2" aria-hidden="true"></i>
                                {% endif %}
                                <span class="flex-grow-1">{{ current_user.name or current_user.email }}</span>
                            </h6>
                        </li>
                        <li role="presentation"><hr class="dropdown-divider"></li>
                        <!-- Subscription feature not yet implemented
                        <li role="presentation">
                            <a class="dropdown-item" 
                               href="#"
                               role="menuitem">
                                <i class="fas fa-crown" aria-hidden="true"></i> My Subscription
                            </a>
                        </li>
                        -->
                        <!-- Subscription plans not yet implemented
                        <li role="presentation">
                            <a class="dropdown-item" 
                               href="#"
                               role="menuitem">
                                <i class="fas fa-rocket" aria-hidden="true"></i> Upgrade Plan
                            </a>
                        </li>
                        -->
                        <li role="presentation"><hr class="dropdown-divider"></li>
                        <li role="presentation">
                            <button class="dropdown-item" 
                                    type="button"
                                    onclick="window.mediaScraperApp.showAccountSettings()"
                                    role="menuitem">
                                <i class="fas fa-user-cog" aria-hidden="true"></i> Account Settings
                            </button>
                        </li>
                        <li role="presentation">
                            <button class="dropdown-item" 
                                    type="button"
                                    onclick="window.mediaScraperApp.showAppSettings()"
                                    role="menuitem">
                                <i class="fas fa-cogs" aria-hidden="true"></i> App Settings
                            </button>
                        </li>
                        <li role="presentation"><hr class="dropdown-divider"></li>
                        <li role="presentation">
                            <button class="dropdown-item" 
                                    type="button"
                                    onclick="window.mediaScraperApp.showHelp()"
                                    role="menuitem">
                                <i class="fas fa-question-circle" aria-hidden="true"></i> Help
                            </button>
                        </li>
                        {% if current_user.email.lower() == 'sop1973@gmail.com' %}
                        <li role="presentation"><hr class="dropdown-divider"></li>
                        <li role="presentation">
                            <a class="dropdown-item text-warning" 
                               href="{{ url_for('admin_test') }}"
                               role="menuitem">
                                <i class="fas fa-users-cog" aria-hidden="true"></i> Admin Dashboard
                            </a>
                        </li>
                        {% endif %}
                        <li role="presentation"><hr class="dropdown-divider"></li>
                        <li role="presentation">
                            <a class="dropdown-item text-danger" 
                               href="{{ url_for('auth.logout') }}"
                               role="menuitem">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Sign Out
                            </a>
                        </li>
                    </ul>
                </div>
            {% else %}
                <!-- Sign In Button for Guest Users -->
                <a href="{{ url_for('auth.login') }}" 
                   class="btn btn-light sign-in-btn"
                   aria-label="Sign in with Google">
                    <i class="fab fa-google me-2" aria-hidden="true"></i> 
                    Sign In with Google
                </a>
            {% endif %}
        </div>
    </div>
</nav> 
