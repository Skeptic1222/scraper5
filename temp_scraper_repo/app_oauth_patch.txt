
# OAuth Fix - Add these imports and configurations to app.py

# After the existing imports, add:
from werkzeug.middleware.proxy_fix import ProxyFix

# After creating the Flask app, add:
# Configure for IIS deployment
app.config['APPLICATION_ROOT'] = '/scraper'
app.config['PREFERRED_URL_SCHEME'] = 'http'
app.config['SESSION_COOKIE_PATH'] = '/scraper'
app.config['SESSION_COOKIE_SECURE'] = False  # Set to True with HTTPS
app.config['SESSION_COOKIE_HTTPONLY'] = True
app.config['SESSION_COOKIE_SAMESITE'] = 'Lax'

# Add ProxyFix middleware for IIS
app.wsgi_app = ProxyFix(
    app.wsgi_app,
    x_for=1,
    x_proto=1,
    x_host=1,
    x_port=1,
    x_prefix=1
)

# Replace the auth initialization with:
from auth import auth_bp, init_oauth
oauth, google = init_oauth(app)
app.register_blueprint(auth_bp, url_prefix='/auth')
